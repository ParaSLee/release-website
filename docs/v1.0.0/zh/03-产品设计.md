# 03 - 产品设计

**版本**: v1.0.0  
**最后更新**: 2024

---

## 1. 四大核心模块设计

### 1.1 模块一：控制后台系统

#### Popup页面
**功能**：快速概览今日使用情况

**页面布局**：
```
┌─────────────────────────────────┐
│  Website Block                  │
│  ────────────────────────────── │
│  📊 今日使用情况                │
│                                 │
│  youtube.com         🔄         │
│  已用 45分 / 60分   剩余 15分   │
│  ████████░░░░ 75%              │
│                                 │
│  twitter.com        ✓          │
│  已用 15分 / 30分   剩余 15分   │
│  ████░░░░░░░ 50%               │
│                                 │
│  🚨 紧急重启状态: 今日已使用     │
│  ⏰ 固定时间锁定: 22:00-06:00   │
│                                 │
│  [打开设置页面]                  │
└─────────────────────────────────┘
```

#### Options Page
**功能**：完整的配置管理界面

**页面结构**：
```
┌─────────────┬──────────────────────────────┐
│ Website     │  使用限制                      │
│ Block       │                              │
│             │  添加网站                      │
│ ┌─────────┐ │  ┌────────────────────────┐ │
│ │使用限制 │ │  │ 网址: youtube.com       │ │
│ └─────────┘ │  │ 名称: YouTube            │ │
│ ┌─────────┐ │  │ 限制: 1小时              │ │
│ │固定时间 │ │  │ [保存] [取消]            │ │
│ │限制     │ │  └────────────────────────┘ │
│ └─────────┘ │                              │
│ ┌─────────┐ │  网站列表                    │
│ │重置配置 │ │  ┌────────────────────────┐ │
│ └─────────┘ │  │ YouTube  1h/day  🔄✓   │ │
│ ┌─────────┐ │  │ [编辑] [删除]            │ │
│ │数据管理 │ │  │ Twitter  30m/day  ✓     │ │
│ └─────────┘ │  │ [编辑] [删除]            │ │
│             │  └────────────────────────┘ │
└─────────────┴──────────────────────────────┘
```

### 1.2 模块二：内容注入系统

#### 倒计时悬浮窗设计

**展开状态**：
```
┌──────────────────────┐
│ ⏱️ YouTube           │ ← 标题栏（可拖拽）
│ ──────────────────── │
│ 剩余时间              │
│   45:32              │ ← 大号倒计时
│ ████████░░░░ 76%    │ ← 进度条
│                      │
│ 今日已用 14分28秒     │
│ [收起]               │ ← 收起按钮
└──────────────────────┘
```

**收起状态**：
```
     ┌──────┐
     │      │
     │ 45:3 │ ← 倒计时
     │ 2    │
     │ 76%  │ ← 百分比
     │  ⭕  │ ← 圆形进度条
     └──────┘
```

**毛玻璃效果CSS**：
```css
backdrop-filter: blur(12px);
background: rgba(255, 255, 255, 0.7);
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
border: 1px solid rgba(255, 255, 255, 0.3);
border-radius: 16px;
```

### 1.3 模块三：时间管理与锁定系统

#### 三状态流转图

```
         时间到达上限/进入固定时间锁定
    Active ────────────────────→ Pending
      ↑                             │ 30秒倒计时
      │                             │ 或点击锁定按钮
      │                             ↓
      └────────────────────────  Locked
           重启功能
         (多层验证)
```

#### Pending状态UI设计

```
┌─────────────────────────────────────────┐
│                                         │
│        🔒 浏览时间即将结束               │
│                                         │
│              30                         │ ← 大号倒计时
│            秒后锁定                      │
│                                         │
│     当前网址浏览时间已到达上限            │
│     30秒后将彻底无法访问                 │
│                                         │
│  ┌────────────┐    ┌────────────┐      │
│  │ 紧急使用    │    │ 立即锁定    │      │
│  │ +10分钟    │    │            │      │
│  └────────────┘    └────────────┘      │
│                                         │
└─────────────────────────────────────────┘
       ↑ 全屏毛玻璃遮罩，阻止页面交互
       ↑ 背景模糊度从5px → 20px
```

### 1.4 模块四：阻止页面与重启系统

#### 阻止页面设计

```
┌─────────────────────────────────────────┐
│                                         │
│         🚫 今日浏览时间已用完            │
│                                         │
│            YouTube                      │
│         今日已使用 1小时                 │
│                                         │
│  ────────────────────────────────────── │
│                                         │
│  💡 "成功的秘诀在于坚持自己的目标"       │
│                                         │
│  📚 建议的替代活动:                      │
│  • 阅读一本书                            │
│  • 户外运动30分钟                        │
│  • 学习新技能                            │
│                                         │
│  📊 使用统计                             │
│  [图表显示本周使用情况]                  │
│                                         │
│           [重启]                        │
│                                         │
└─────────────────────────────────────────┘
```

#### 重启流程设计

**第一个弹窗**：
```
┌──────────────────────────────────┐
│  ⚠️  警告：请坚持自律             │
│                                  │
│  "自律是通往成功的桥梁"           │
│                                  │
│  ────────────────────────────── │
│                                  │
│  请选择：                         │
│                                  │
│  ┌────────────────────────────┐ │
│  │ 确定重启 (10秒后可点击)     │ │ ← 灰色禁用
│  │          10                 │ │
│  └────────────────────────────┘ │
│                                  │
│  ┌────────────────────────────┐ │
│  │ 紧急重启 (今日限1次)        │ │ ← 高亮
│  │ ⚡ 立即恢复访问             │ │
│  └────────────────────────────┘ │
│                                  │
│  ┌────────────────────────────┐ │
│  │ 取消重启                    │ │
│  └────────────────────────────┘ │
│                                  │
└──────────────────────────────────┘
```

**第二个弹窗**：
```
┌──────────────────────────────────────┐
│  📝 请输入以下文字以确认重启           │
│                                      │
│  ┌─────────────────────────────────┐ │
│  │ apple orange banana grape fruit │ │
│  │ computer keyboard mouse screen  │ │
│  │ window  door table chair desk   │ │
│  │ ...  (共120个单词，12行)         │ │
│  └─────────────────────────────────┘ │
│                                      │
│  请在下方输入框输入上述文字:           │
│  ┌─────────────────────────────────┐ │
│  │ apple orange...                 │ │ ← 用户输入
│  │                                 │ │
│  │                                 │ │
│  └─────────────────────────────────┘ │
│                                      │
│  匹配度: ██████████░░ 83%           │
│                                      │
│  ┌───────────┐      ┌───────────┐  │
│  │  确定 (灰) │      │   取消     │  │
│  └───────────┘      └───────────┘  │
│                                      │
└──────────────────────────────────────┘
```

**礼花效果**：
```
     *   *      *
  *    🎉    *     *
    *     *    *
 *    🎊   *      *
        *
   恭喜你的坚持！
```

---

## 2. 用户交互流程

### 2.1 正常使用流程
```
用户打开受限网站
    ↓
Background检查状态
    ↓
状态为Active → 开始计时
    ↓
Content Script注入悬浮窗
    ↓
悬浮窗实时显示剩余时间
    ↓
用户关闭页面 → 暂停计时
    ↓
用户切换Tab → 切换计时对象
```

### 2.2 时间到达限制流程
```
时间到达上限
    ↓
状态切换: Active → Pending
    ↓
注入全屏毛玻璃遮罩
    ↓
显示30秒倒计时
    ↓
用户选择:
    ├─ 等待30秒 → Locked → 跳转阻止页面
    ├─ 点击"紧急使用" → Active(+10分钟)
    └─ 点击"立即锁定" → Locked → 跳转阻止页面
```

### 2.3 重启功能流程
```
用户在阻止页面点击"重启"
    ↓
显示第一个弹窗
    ↓
用户选择:
    ├─ 点击"取消" → 礼花效果 → 关闭弹窗
    ├─ 点击"紧急重启" → 检查今日是否已用
    │       ├─ 未使用 → 立即重启 → Active
    │       └─ 已使用 → 提示"今日已使用"
    └─ 等待10秒 → 点击"确定重启"
            ↓
       显示第二个弹窗
            ↓
       用户输入120个单词
            ↓
       实时验证匹配度
            ↓
       用户选择:
            ├─ 点击"取消" → 礼花效果
            └─ 输入完全匹配 → 点击"确定"
                    ↓
                  执行重启
                    ↓
                usedTime = 0
                status = Active
                restarted = true
                    ↓
               跳转回原网站
```

---

## 3. 数据流设计

### 3.1 数据存储结构
```
chrome.storage.local
├── websites: WebsiteConfig[]       # 网站配置
├── usageData: UsageData[]         # 使用数据
├── timeLockSettings: TimeLockSettings  # 固定时间锁定
└── globalSettings: GlobalSettings  # 全局设置
```

### 3.2 数据同步机制
```
Background Service Worker (数据中心)
    ↓ ↑ (chrome.runtime.sendMessage)
Content Script (各个Tab)
    ↓ ↑ (chrome.storage.onChanged)
Popup / Options (UI界面)
```

---

## 4. UI/UX设计原则

### 4.1 设计原则

#### 温和而坚定
- 不是冰冷的"禁止"
- 而是温暖的"提醒"
- 给予用户尊重和选择权

#### 正向激励
- 礼花效果
- 励志语句
- 使用统计可视化

#### 渐进式引导
- 30秒缓冲期
- 多层验证
- 逐步增加难度

### 4.2 视觉设计规范

#### 颜色系统
```
主色调：
- Primary: #3B82F6 (蓝色)
- Success: #10B981 (绿色)
- Warning: #F59E0B (橙色)
- Danger: #EF4444 (红色)

中性色：
- Gray-50: #F9FAFB
- Gray-100: #F3F4F6
- Gray-900: #111827
```

#### 字体系统
```
标题: 
- font-size: 24px
- font-weight: 700

正文:
- font-size: 16px
- font-weight: 400

小字:
- font-size: 14px
- font-weight: 400
```

#### 圆角系统
```
- sm: 8px (按钮)
- md: 12px (卡片)
- lg: 16px (悬浮窗)
- full: 9999px (圆形)
```

### 4.3 动画设计

#### 过渡动画
```css
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
```

#### 模糊度变化
```javascript
// 30秒内从5px线性增加到20px
const blurAmount = 5 + (remainingSeconds / 30) * 15;
```

#### 礼花效果
```javascript
confetti({
  particleCount: 100,
  spread: 70,
  origin: { y: 0.6 }
});
```

---

## 5. 组件设计

### 5.1 核心组件列表

| 组件名 | 用途 | 位置 |
|-------|------|------|
| Sidebar | 侧边栏导航 | Options |
| WebsiteList | 网站列表 | Options |
| WebsiteForm | 添加/编辑表单 | Options |
| TimeLockManager | 固定时间管理 | Options |
| DataManager | 数据管理 | Options |
| TimerDisplay | 倒计时显示 | Content Script |
| CircularProgress | 圆形进度条 | Content Script |
| PendingLockUI | 待锁定UI | Content Script |
| RestartDialog1 | 第一个重启弹窗 | Block Page |
| RestartDialog2 | 第二个重启弹窗 | Block Page |
| ConfettiEffect | 礼花效果 | 多处 |

### 5.2 组件关系图
```
App
├── Popup
│   ├── UsageList
│   └── StatusBadge
├── Options
│   ├── Sidebar
│   ├── UsageLimitTab
│   │   ├── WebsiteList
│   │   └── WebsiteForm
│   ├── TimeLockTab
│   │   └── TimeLockManager
│   ├── ResetTab
│   │   └── ResetTimeConfig
│   └── DataTab
│       └── DataManager
├── Content Script
│   ├── TimerOverlay
│   │   ├── TimerDisplay
│   │   └── CircularProgress
│   └── PendingLockOverlay
│       └── PendingLockUI
└── Block Page
    ├── BlockedInfo
    ├── MotivationalQuote
    ├── UsageChart
    └── RestartButton
        ├── RestartDialog1
        ├── RestartDialog2
        └── ConfettiEffect
```

---

**文档版本**: v1.0.0  
**维护者**: ParaSLee  
**最后更新**: 2024
